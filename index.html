<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Das Budenzauber Quiz</title>
  <style>
    :root {
      --primary: #004d8c;
      --secondary: #0080c0;
      --accent: #ffcc00;
      --light: #f8f9fa;
      --dark: #212529;
      --success: #28a745;
      --danger: #dc3545;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    body { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: var(--dark); min-height: 100vh; padding: 20px; }
    .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); overflow: hidden; }
    .quiz-container { padding: 30px; }
    .question { font-size: 1.5rem; margin-bottom: 25px; line-height: 1.4; }
    .options { display: flex; flex-direction: column; gap: 12px; }
    .option { padding: 16px; border: 2px solid #ddd; border-radius: 10px; cursor: pointer; font-size: 1.1rem; transition: all 0.3s ease; background: #f9f9f9; }
    .option:hover { background: var(--light); border-color: var(--secondary); }
    .option.selected { border-color: var(--secondary); background: #e3f2fd; }
    .option.correct { border-color: var(--success); background: #d4edda; color: var(--success); }
    .option.incorrect { border-color: var(--danger); background: #f8d7da; color: var(--danger); }
    .option.disabled { cursor: not-allowed; opacity: 0.7; }
    .explanation { margin-top: 20px; padding: 18px; background: #f0f7ff; border-left: 5px solid var(--secondary); border-radius: 0 8px 8px 0; font-style: italic; font-size: 1.05rem; }
    .controls { display: flex; justify-content: space-between; margin-top: 30px; gap: 10px; }
    button { padding: 14px 24px; border: none; border-radius: 8px; font-size: 1.1rem; cursor: pointer; transition: all 0.3s; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
    .btn-prev { background: #6c757d; color: white; }
    .btn-next { background: var(--secondary); color: white; }
    .btn-start { background: var(--accent); color: var(--dark); font-weight: bold; font-size: 1.3rem; padding: 18px 40px; display: block; margin: 40px auto; border-radius: 50px; width: 100%; }
    .btn-view-leaderboard { background: var(--secondary); color: white; margin-top: 15px; font-size: 1.1rem; padding: 12px 25px; width: 100%; }
    .btn-reset { background: #dc3545; color: white; margin-top: 10px; width: 100%; }
    .input-group { margin: 20px 0; }
    input { width: 100%; padding: 14px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; }
    .result { text-align: center; padding: 50px 30px; }
    .result h2 { font-size: 2.5rem; color: var(--primary); margin-bottom: 15px; }
    .score { font-size: 2rem; font-weight: bold; color: var(--accent); margin: 15px 0; }
    .result-message { font-size: 1.2rem; margin: 20px 0; }
    .btn-restart { background: var(--accent); color: var(--dark); font-weight: bold; padding: 16px 40px; border-radius: 50px; margin-top: 20px; width: 100%; }
    .progress { height: 8px; background: #e9ecef; border-radius: 4px; overflow: hidden; margin: 20px 0; }
    .progress-bar { height: 100%; background: var(--accent); width: 0%; transition: width 0.5s ease; }
    .leaderboard { padding: 30px; max-height: 600px; overflow-y: auto; }
    .leaderboard h2 { text-align: center; color: var(--primary); margin-bottom: 20px; }
    .leaderboard table { width: 100%; border-collapse: collapse; }
    .leaderboard th, .leaderboard td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
    .leaderboard th { background: var(--primary); color: white; font-weight: bold; }
    .leaderboard tr:nth-child(even) { background: #f9f9f9; }
    .leaderboard tr:hover { background: #e3f2fd; }
    .leaderboard .rank { font-weight: bold; color: var(--accent); }
    .hide { display: none; }
    .loading { text-align: center; padding: 20px; color: var(--secondary); }
    @media (max-width: 600px) { .question { font-size: 1.3rem; } .options .option { padding: 14px; font-size: 1rem; } .controls { flex-direction: column; } .btn-start, .btn-restart { font-size: 1.2rem; padding: 16px; } }
  </style>
</head>
<body>
  <div class="container">

    <div id="name-screen" class="quiz-container">
      <h2>Das Budenzauber Quiz</h2>
      <p>Teste dein Wissen √ºber D√ñRKEN ‚Äì mit Weihnachtszauber!</p>
      <div class="input-group">
        <label for="name-input">Dein Name:</label>
        <input type="text" id="name-input" placeholder="z. B. Max Mustermann">
      </div>
      <button class="btn-start" onclick="startQuiz()">Quiz starten</button>
      <button class="btn-view-leaderboard" onclick="showLeaderboard()">Bestenliste ansehen</button>
    </div>

    <div id="quiz-screen" class="quiz-container hide">
      <div class="progress">
        <div class="progress-bar" id="progress-bar"></div>
      </div>
      <div class="question" id="question-text"></div>
      <div class="options" id="options-container"></div>
      <div class="explanation hide" id="explanation"></div>
      <div class="controls">
        <button class="btn-prev hide" id="prev-btn" onclick="prevQuestion()">Zur√ºck</button>
        <button class="btn-next" id="next-btn" disabled onclick="nextQuestion()">Weiter</button>
      </div>
    </div>

    <div id="result-screen" class="result hide">
      <h2>Gl√ºckwunsch!</h2>
      <p>Du hast das Budenzauber Quiz abgeschlossen.</p>
      <div class="score" id="final-score"></div>
      <p class="result-message" id="result-message"></p>
      <button class="btn-restart" onclick="restartQuiz()">Nochmal spielen</button>
      <button class="btn-view-leaderboard" onclick="showLeaderboard()">Bestenliste ansehen</button>
    </div>

    <div id="leaderboard-screen" class="leaderboard hide">
      <h2>üèÜ Bestenliste</h2>
      <div id="leaderboard-loading" class="loading hide">Lade...</div>
      <table id="leaderboard-table">
        <thead>
          <tr>
            <th>Rang</th>
            <th>Name</th>
            <th>Punkte</th>
            <th>Datum</th>
          </tr>
        </thead>
        <tbody id="leaderboard-body"></tbody>
      </table>
      <button class="btn-restart" onclick="goBackToStart()">Zur√ºck zum Start</button>
      <button id="reset-btn" class="btn-reset" onclick="resetLeaderboard()">üîí Bestenliste zur√ºcksetzen</button>
      <p style="font-size:0.9rem;margin-top:10px;color:#666">Hinweis: Zur sicheren Zur√ºcksetzung wird eine serverseitige Funktion mit gepr√ºftem Secret ben√∂tigt (Anleitung im Repository-README).</p>
    </div>

  </div>

  <!-- Supabase client (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

  <script>
    // --- KONFIGURATION ---
    // Ersetze diese Werte in deiner Deployment-Umgebung (z.B. Netlify / Vercel) oder setze sie lokal zum Testen.
    const SUPABASE_URL = "REPLACE_WITH_YOUR_SUPABASE_URL"; // z.B. https://xyzcompany.supabase.co
    const SUPABASE_ANON_KEY = "REPLACE_WITH_YOUR_SUPABASE_ANON_KEY"; // public anon key (nur f√ºr Inserts/Selects, nicht f√ºr Admin/Deletes)

    let supabase = null;
    if (SUPABASE_URL && SUPABASE_ANON_KEY && !SUPABASE_URL.includes('REPLACE')) {
      try {
        supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        console.log('Supabase client initialisiert');
      } catch (err) {
        console.warn('Fehler beim Initialisieren von Supabase, Fallback auf localStorage.', err);
        supabase = null;
      }
    }

    const questions = [
      {q: "Welche beiden Br√ºder gr√ºndeten 1892 die Firma D√ñRKEN?", o: ["Dr. Hellmut Herminghaus und Ewald D√∂rken", "Karl D√∂rken und Dr. Heinrich Herminghaus", "Karl E. D√∂rken und Ute Herminghaus", "Dr. Carl D√∂rken und Ewald D√∂rken"], c: 3, e: "Die Br√ºder Dr. Carl D√∂rken (Chemiker) und Ewald D√∂rken (Kaufmann) gr√ºndeten 1892 gemeinsam das Unternehmen D√ñRKEN."},
      {q: "In welche zwei Hauptgesch√§ftsbereiche ist D√ñRKEN heute strukturiert?", o: ["Bautenfarben und Bauverbundfolien", "Multitexx und Protec Systempasten", "D√∂rken MKS-Systeme und CD-Color", "D√ñRKEN Coatings und D√ñRKEN Membranes"], c: 3, e: "Die D√ñRKEN-Gruppe ist in zwei Gesch√§ftsbereiche gegliedert: D√ñRKEN Coatings und D√ñRKEN Membranes."},
      {q: "Was ist der Hauptvorteil der doppelten Klebestreifen bei DELTA-MAXX PLUS?", o: ["Langzeitbest√§ndigkeit von 50 Jahren", "Erh√∂hte Hagelschlagbest√§ndigkeit", "Material- und Zeitersparnis durch Wendbarkeit", "Verarbeitbarkeit bei -10 Grad C"], c: 2, e: "Dank der beidseitigen Klebestreifen kann ein Restst√ºck gedreht und weiterverwendet werden."},
      {q: "Welche Funktion erf√ºllen DELTA-Fassadenbahnen?", o: ["Putztr√§gergewebe", "Schutz der D√§mmschicht vor Feuchtigkeit", "Dampfsperre innen", "Druckfestigkeit erh√∂hen"], c: 1, e: "DELTA-Fassadenbahnen bilden eine sch√ºtzende Hinterl√ºftungsebene."},
      {q: "Welchen Grundsatz verfolgt D√ñRKEN seit √ºber 125 Jahren?", o: ["Innovation ist unsere Tradition", "D√ñRKEN sch√ºtzt Werte", "Qualit√§t Made in Germany", "Experten f√ºr das Verborgene"], c: 1, e: "Der Leitsatz D√ñRKEN sch√ºtzt Werte umfasst materiellen und immateriellen Schutz."},
      {q: "Mit welchem Siegel wurde D√ñRKEN f√ºr Innovationsmanagement ausgezeichnet?", o: ["Materialeffizienzpreis", "Fair Company", "BEST PLACE TO LEARN", "TOP 100"], c: 3, e: "Das TOP 100-Siegel zeichnet die innovativsten Unternehmen aus."},
      {q: "Welchen Mobilit√§ts-Benefit bietet D√ñRKEN?", o: ["JobRad", "Treibstoffzusch√ºsse", "Firmenwagen f√ºr alle", "√ñPNV-Ticket"], c: 0, e: "√úber JobRad k√∂nnen Mitarbeiter Fahrr√§der und E-Bikes leasen."},
      {q: "Wo hat D√ñRKEN seit 2015 ein modernes Spinnvlies-Werk?", o: ["Stuttgart", "D√ºren", "Herdecke", "Hagen-Vorhalle"], c: 3, e: "Am Standort Hagen-Vorhalle errichtete D√ñRKEN eines der modernsten Werke."},
      {q: "Welche Garantie gibt es auf DELTA-MAXX Unterdeckbahnen?", o: ["25 Jahre", "10 Jahre", "100 Jahre", "30 Jahre"], c: 3, e: "D√ñRKEN gew√§hrt 30 Jahre Garantie auf die fachgerechte Funktion."},
      {q: "Was macht das Geotextil bei der DELTA-MS DRAIN?", o: ["Verhindert Zuschl√§mmen", "Abdichtung gegen Wasser", "Gleitende Verlegung", "UV-Schutz"], c: 0, e: "Das Filtervlies h√§lt feine Bodenpartikel zur√ºck."},
      {q: "Welches Lackprodukt brachte D√ñRKEN 1902 den Durchbruch?", o: ["EBURIT", "Lucite", "DELTA-MKS", "Bunt-Delta"], c: 0, e: "Der holzartige Lack EBURIT brachte den Durchbruch."},
      {q: "Was war das Ergebnis der Umstrukturierung 2020?", o: ["√úbernahme Wischemann", "Gr√ºndung Bauverbundfolien", "Erster externer Vorstand", "Zusammenschluss zu D√∂rken Coatings GmbH"], c: 3, e: "Die Gesch√§ftsbereiche wurden zur D√∂rken Coatings GmbH zusammengef√ºhrt."},
      {q: "Welches Produkt markierte 1963 den Einstieg in Bauverbundfolien?", o: ["Dachbeschichtung", "DELTA-FOL SPF", "DELTA-MS", "DELTA-LIQUIXX"], c: 1, e: "Die Unterspannbahn DELTA-FOL SPF war der Einstieg."},
      {q: "Welche Technologie sorgt f√ºr h√∂here Festigkeit bei Vliesen?", o: ["Active-Membrane-System", "BiCo Kern-Mantel-Fasertechnologie", "Orkanofen-Test", "Ad Tec Klebetechnologie"], c: 1, e: "Die BiCo Kern-Mantel-Fasertechnologie verbessert die Festigkeit."},
      {q: "Wof√ºr wurde DELTA-LIQUIXX entwickelt?", o: ["Nageldichtungsmasse", "Luftdichte Anschl√ºsse herstellen", "Flachdach-Beschichtung", "Korrosionsschutz"], c: 1, e: "DELTA-LIQUIXX erm√∂glicht luftdichte Abdichtung in komplexen Bereichen."},
      {q: "Wie viele interne Entwickler hat D√ñRKEN?", o: ["Etwa 75", "√úber 100", "Etwa 10", "Etwa 40"], c: 3, e: "Rund 40 Entwickler arbeiten an Innovation und Optimierung."},
      {q: "Welche Marken vereint D√ñRKEN Membranes?", o: ["DELTA und LUCITE", "DELTA und EBURIT", "DELTA und Multitexx", "DELTA und CD-Color"], c: 2, e: "D√ñRKEN Membranes b√ºndelt DELTA und Multitexx."},
      {q: "Welche dritte S√§ule kam 2022 hinzu?", o: ["Logistik", "Digitale Dienstleistungen", "Erneuerbare Energien", "Kunststoffformteile"], c: 3, e: "Durch √úbernahme der Wischemann-Gruppe kam der Bereich Kunststoffformteile hinzu."},
      {q: "Wie hei√üt das Betriebsrestaurant in Herdecke?", o: ["Kochs Treff", "Die Kantine", "Herd-Ecke", "DELTA-Bistro"], c: 2, e: "Der Name Herd-Ecke ist ein Wortspiel mit Herdecke."},
      {q: "Welche Eigenschaft hat die DELTA-TERRAXX ULTRA?", o: ["7 Standardfarben", "Besonders leicht", "Druckfestigkeit 750 kN/m2", "Heizfunktion"], c: 2, e: "Die DELTA-TERRAXX ULTRA hat extreme Druckfestigkeit."},
      {q: "Was ist die Funktion der DELTA-PT?", o: ["Sauberkeitsschicht", "Au√üenabdichtung", "Sickerschicht", "Kellerwand-Sanierung"], c: 3, e: "Die DELTA-PT ist f√ºr Innensanierung feuchter Kellerw√§nde."},
      {q: "Was macht Lucite MultiResist PRO besonders?", o: ["Farbwechsel beim Trocknen", "Resistent ohne Biozide", "Reduziert Zunder um 80%", "L√∂sungsmittelfreier Anstrich"], c: 1, e: "Lucite MultiResist PRO ist resistent ohne klassische Biozide."},
      {q: "Welches Pr√ºfverfahren entwickelte D√ñRKEN?", o: ["Kegelfallversuch", "Schlagregentest", "Orkanofen-Test", "CBR-Stempeldurchdr√ºck"], c: 2, e: "Der Orkanofen-Test ist ein Thermo-Oxidations-Verfahren."},
      {q: "Welches Ereignis der 1970er war herausfordernd?", o: ["W√§hrungsreform", "√ñlkrise", "EU-Gr√ºndung", "Zweiter Weltkrieg"], c: 1, e: "Die √ñlkrise f√ºhrte zu dramatischem Anstieg der Roh√∂lpreise."},
      {q: "In wie vielen Berufen bildet D√ñRKEN aus?", o: ["18", "25", "5", "12"], c: 0, e: "D√ñRKEN bildet in 18 Ausbildungsberufen aus."},
      {q: "Welches Korrosionsschutzsystem kam 1981?", o: ["DELTA-PROTEKT KL 105", "DELTA-MKS", "DELTA-HEAT", "LUCITE"], c: 1, e: "DELTA-MKS war ein schwermetallfreies Mikroschicht-System."},
      {q: "Wodurch zeichnen sich D√ñRKEN-Mitarbeiter aus?", o: ["Kurzfristige Ziele", "Strikte Anweisungsbefolgung", "Individualismus", "Sorgfalt und Ehrlichkeit"], c: 3, e: "Sorgfalt, Verantwortungsbewusstsein und Ehrlichkeit sind zentral."},
      {q: "Was war ein Nachhaltigkeitsschritt der 1990er?", o: ["L√∂sungsmittelfreie Baufarben", "Recycelbare Noppenbahnen", "Photovoltaikanlage", "Umweltmanagement-Team"], c: 0, e: "D√ñRKEN stieg in l√∂sungsmittelfreie Baufarben ein."},
      {q: "Welche Unterst√ºtzung bietet D√ñRKEN beim Wohnen?", o: ["Zinslose Darlehen", "Umzugsservice", "Kindergarten", "DELTA Immobilien"], c: 3, e: "D√ñRKEN vermittelt Wohnraum √ºber DELTA Immobilien."},
      {q: "Was war das Ziel von WIR.IHR.HIER.?", o: ["Weihnachtsgeld", "Lokale Wirtschaft unterst√ºtzen", "125-Jahr-Feier", "Rekordumsatz-Belohnung"], c: 1, e: "Das Projekt unterst√ºtzte die lokale Wirtschaft mit 1.000 Euro pro Mitarbeiter."}
    ];

    let cur = 0, score = 0, sel = null, ans = Array(questions.length).fill(null), name = "";

    // Supabase-gest√ºtzte Lese-/Schreibfunktionen mit localStorage-Fallback
    async function loadLB() {
      if (supabase) {
        try {
          const { data, error } = await supabase
            .from('leaderboard')
            .select('*')
            .order('score', { ascending: false })
            .order('ts', { ascending: true })
            .limit(50);
          if (error) throw error;
          return data || [];
        } catch (err) {
          console.warn('Fehler beim Laden der Bestenliste von Supabase, verwende localStorage als Fallback', err);
        }
      }
      try {
        const raw = localStorage.getItem('doerken-lb');
        if (raw) return JSON.parse(raw);
        return [];
      } catch (error) {
        console.log('Leaderboard laden fehlgeschlagen:', error);
        return [];
      }
    }

    async function saveLBEntry(entry) {
      if (supabase) {
        try {
          const { error } = await supabase.from('leaderboard').insert([entry]);
          if (error) throw error;
          return true;
        } catch (err) {
          console.warn('Fehler beim Speichern in Supabase, speichere lokal als Fallback', err);
        }
      }
      // Fallback: lokale Speicherung (beh√§lt bestehendes Verhalten)
      try {
        const lb = await loadLB();
        lb.push(entry);
        lb.sort((a, b) => b.score - a.score || a.ts - b.ts);
        const top = lb.slice(0, 50);
        localStorage.setItem('doerken-lb', JSON.stringify(top));
        return true;
      } catch (error) {
        console.error('Fehler beim Speichern lokal:', error);
        return false;
      }
    }

    async function resetLeaderboard() {
      // Entfernt das clientseitige Passwort-Verfahren. Zur sicheren Zur√ºcksetzung muss eine serverseitige Funktion verwendet werden.
      if (!confirm('Wirklich die Bestenliste zur√ºcksetzen? Dies l√∂scht alle Eintr√§ge.')) return;

      // Versuche, serverseitige Funktion aufzurufen. Der Endpunkt ist ein Beispiel f√ºr Netlify/Vercel.
      const secret = prompt('Gebe das Reset-Secret ein (wird serverseitig gepr√ºft):');
      if (!secret) return;

      try {
        const res = await fetch('/.netlify/functions/reset-leaderboard', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ secret })
        });
        const json = await res.json();
        if (!res.ok) throw new Error(json?.message || 'Fehler');
        alert('Bestenliste serverseitig zur√ºckgesetzt.');
        showLeaderboard();
      } catch (err) {
        console.warn('Serverseitige Zur√ºcksetzung fehlgeschlagen oder nicht verf√ºgbar:', err);
        // Fallback: L√∂sche localStorage (nur lokal)
        if (confirm('Serverseitige Zur√ºcksetzung fehlgeschlagen. Lokales L√∂schen der Bestenliste durchf√ºhren?')) {
          localStorage.removeItem('doerken-lb');
          alert('Lokale Bestenliste gel√∂scht.');
          showLeaderboard();
        }
      }
    }

    function showScreen(id) {
      ['name-screen', 'quiz-screen', 'result-screen', 'leaderboard-screen'].forEach(s => {
        document.getElementById(s).classList.add('hide');
        document.getElementById(s).style.display = 'none';
      });
      document.getElementById(id).classList.remove('hide');
      document.getElementById(id).style.display = 'block';
    }

    function startQuiz() {
      name = document.getElementById('name-input').value.trim();
      if (!name) { alert('Bitte Namen eingeben!'); return; }
      cur = 0; score = 0; sel = null; ans = Array(questions.length).fill(null);
      showScreen('quiz-screen'); showQ();
    }

    function showQ() {
      if (cur >= questions.length) { showRes(); return; }
      const q = questions[cur];
      document.getElementById('question-text').textContent = (cur + 1) + '. ' + q.q;
      const cont = document.getElementById('options-container'); cont.innerHTML = '';
      const wasAns = ans[cur] !== null;
      q.o.forEach((opt, i) => {
        const btn = document.createElement('div'); btn.className = 'option'; btn.textContent = opt;
        if (wasAns) {
          btn.classList.add('disabled');
          if (i === ans[cur]) { btn.classList.add('selected'); btn.classList.add(i === q.c ? 'correct' : 'incorrect'); }
          if (i === q.c) btn.classList.add('correct');
        } else { btn.onclick = () => selAns(i); }
        cont.appendChild(btn);
      });
      const exp = document.getElementById('explanation');
      if (wasAns) { exp.textContent = q.e; exp.classList.remove('hide'); document.getElementById('next-btn').disabled = false; }
      else { exp.classList.add('hide'); document.getElementById('next-btn').disabled = true; }
      document.getElementById('progress-bar').style.width = (cur / questions.length * 100) + '%';
      document.getElementById('prev-btn').classList.toggle('hide', cur === 0);
    }

    function selAns(i) {
      if (sel !== null) return;
      sel = i; const opts = document.querySelectorAll('.option');
      opts.forEach((o, idx) => {
        o.classList.add('disabled'); o.onclick = null;
        if (idx === i) { o.classList.add('selected'); o.classList.add(idx === questions[cur].c ? 'correct' : 'incorrect'); if (idx === questions[cur].c) score++; }
        if (idx === questions[cur].c) o.classList.add('correct');
      });
      document.getElementById('explanation').textContent = questions[cur].e; document.getElementById('explanation').classList.remove('hide'); document.getElementById('next-btn').disabled = false;
    }

    function nextQuestion() { ans[cur] = sel; cur++; sel = null; showQ(); }
    function prevQuestion() { if (cur > 0) { cur--; sel = ans[cur]; showQ(); } }

    async function showRes() {
      showScreen('result-screen'); document.getElementById('final-score').textContent = score + ' / ' + questions.length;
      let msg = '';
      if (score === questions.length) msg = 'Hervorragend! Du kennst D√ñRKEN perfekt!';
      else if (score >= questions.length * 0.8) msg = 'Sehr gut! Tiefes Verst√§ndnis!';
      else if (score >= questions.length * 0.6) msg = 'Gut gemacht!';
      else msg = 'Du bist auf dem richtigen Weg!';
      document.getElementById('result-message').textContent = msg;

      const entry = { name, score, date: new Date().toLocaleString('de-DE'), ts: Date.now() };
      await saveLBEntry(entry);
    }

    function restartQuiz() { showScreen('name-screen'); }

    async function showLeaderboard() {
      showScreen('leaderboard-screen'); const tbody = document.getElementById('leaderboard-body'); const load = document.getElementById('leaderboard-loading'); load.classList.remove('hide'); tbody.innerHTML = '';
      try {
        const lb = await loadLB(); load.classList.add('hide'); if (!lb || lb.length === 0) { tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;padding:20px;">Keine Eintr√§ge</td></tr>'; }
        else {
          lb.slice(0, 50).forEach((e, i) => {
            const tr = document.createElement('tr');
            const scoreText = (e.score !== undefined) ? (e.score + '/' + questions.length) : e.score;
            const dateText = e.date || e.created_at || '';
            tr.innerHTML = '<td class="rank">' + (i + 1) + '</td><td>' + (e.name || '') + '</td><td>' + scoreText + '</td><td>' + dateText + '</td>';
            tbody.appendChild(tr);
          });
        }
      } catch (err) {
        load.classList.add('hide'); tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">Fehler</td></tr>';
      }
    }

    function goBackToStart() { showScreen('name-screen'); }

    document.getElementById('name-input').addEventListener('keypress', e => { if (e.key === 'Enter') startQuiz(); });
  </script>
</body>
</html>
